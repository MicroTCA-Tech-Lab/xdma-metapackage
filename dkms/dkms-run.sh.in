#!/bin/bash

if [[ $EUID -ne 0 ]]; then
   echo "Skipping dkms build/install w/o root privileges."
   exit 0
fi

# Remove module in case it was installed previously
dkms remove xdma/@CMAKE_PROJECT_VERSION@ --all || true

# Build dkms & update udev
dkms add xdma/@CMAKE_PROJECT_VERSION@
dkms build xdma/@CMAKE_PROJECT_VERSION@ && dkms install xdma/@CMAKE_PROJECT_VERSION@ || true

udevadm trigger
modprobe xdma
